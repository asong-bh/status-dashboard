<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>BH System Status Dashboard</title>
  <link rel="icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 32 32'><rect width='32' height='32' rx='6' fill='%230d0f14'/><circle cx='16' cy='16' r='8' fill='%2300e87a'/></svg>"/>
  <link href="https://fonts.googleapis.com/css2?family=IBM+Plex+Mono:wght@400;600&family=IBM+Plex+Sans:wght@300;400;600&display=swap" rel="stylesheet"/>
  <style>
    :root {
      --bg: #0d0f14;
      --surface: #141720;
      --border: #1f2433;
      --green: #00e87a;
      --yellow: #f5c400;
      --red: #ff3b5c;
      --gray: #4a5168;
      --text: #e2e6f0;
      --muted: #6b7490;
      --accent: #3d7fff;
    }

    * { box-sizing: border-box; margin: 0; padding: 0; }

    body {
      background: var(--bg);
      color: var(--text);
      font-family: 'IBM Plex Sans', sans-serif;
      min-height: 100vh;
      padding: 40px 32px;
    }

    header {
      display: flex;
      align-items: flex-start;
      justify-content: space-between;
      margin-bottom: 48px;
      flex-wrap: wrap;
      gap: 16px;
    }

    .header-left h1 {
      font-family: 'IBM Plex Mono', monospace;
      font-size: 13px;
      font-weight: 600;
      letter-spacing: 0.12em;
      text-transform: uppercase;
      color: var(--accent);
      margin-bottom: 6px;
    }

    .header-left h2 {
      font-size: 28px;
      font-weight: 300;
      letter-spacing: -0.02em;
      color: var(--text);
    }

    .header-right { text-align: right; }

    #clock {
      font-family: 'IBM Plex Mono', monospace;
      font-size: 22px;
      font-weight: 600;
      color: var(--text);
      letter-spacing: 0.05em;
    }

    #date {
      font-size: 12px;
      color: var(--muted);
      margin-top: 4px;
      font-family: 'IBM Plex Mono', monospace;
      text-transform: uppercase;
      letter-spacing: 0.08em;
    }

    .section-label {
      font-family: 'IBM Plex Mono', monospace;
      font-size: 10px;
      font-weight: 600;
      letter-spacing: 0.15em;
      text-transform: uppercase;
      color: var(--muted);
      margin-bottom: 12px;
      padding-left: 2px;
    }

    .grid {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
      gap: 10px;
      margin-bottom: 40px;
    }

    .card {
      background: var(--surface);
      border: 1px solid var(--border);
      border-radius: 6px;
      padding: 16px 18px;
      display: flex;
      align-items: center;
      gap: 14px;
      text-decoration: none;
      color: var(--text);
      transition: border-color 0.15s, background 0.15s;
      cursor: pointer;
      position: relative;
      overflow: hidden;
    }

    .card::before {
      content: '';
      position: absolute;
      left: 0; top: 0; bottom: 0;
      width: 3px;
      background: var(--gray);
      transition: background 0.3s;
    }

    .card.operational::before { background: var(--green); }
    .card.degraded::before    { background: var(--yellow); }
    .card.outage::before      { background: var(--red); }
    .card.unknown::before     { background: var(--gray); }
    .card.manual::before      { background: var(--gray); }

    .card:hover {
      border-color: #2e3450;
      background: #181c2a;
    }

    .status-dot {
      width: 10px;
      height: 10px;
      border-radius: 50%;
      flex-shrink: 0;
      background: var(--gray);
      transition: background 0.3s;
    }

    .card.operational .status-dot { background: var(--green); box-shadow: 0 0 8px rgba(0,232,122,0.5); }
    .card.degraded .status-dot    { background: var(--yellow); box-shadow: 0 0 8px rgba(245,196,0,0.5); }
    .card.outage .status-dot      { background: var(--red); box-shadow: 0 0 8px rgba(255,59,92,0.5); }
    .card.unknown .status-dot     { background: var(--gray); }
    .card.manual .status-dot      { background: var(--gray); }

    .card-info { flex: 1; min-width: 0; }

    .card-name {
      font-size: 14px;
      font-weight: 600;
      white-space: nowrap;
      overflow: hidden;
      text-overflow: ellipsis;
    }

    .card-category {
      font-size: 11px;
      color: var(--muted);
      margin-top: 2px;
      font-family: 'IBM Plex Mono', monospace;
      letter-spacing: 0.04em;
    }

    .card-status {
      font-family: 'IBM Plex Mono', monospace;
      font-size: 10px;
      font-weight: 600;
      letter-spacing: 0.08em;
      text-transform: uppercase;
      flex-shrink: 0;
      color: var(--muted);
      transition: color 0.3s;
    }

    .card.operational .card-status { color: var(--green); }
    .card.degraded .card-status    { color: var(--yellow); }
    .card.outage .card-status      { color: var(--red); }

    .card-arrow {
      font-size: 12px;
      color: var(--muted);
      flex-shrink: 0;
      margin-left: 4px;
    }

    .footer {
      margin-top: 24px;
      font-size: 11px;
      color: var(--muted);
      font-family: 'IBM Plex Mono', monospace;
      display: flex;
      justify-content: space-between;
      align-items: center;
      flex-wrap: wrap;
      gap: 8px;
      border-top: 1px solid var(--border);
      padding-top: 20px;
    }

    .pulse {
      display: inline-block;
      width: 6px;
      height: 6px;
      border-radius: 50%;
      background: var(--green);
      margin-right: 6px;
      animation: pulse 2s infinite;
      vertical-align: middle;
    }

    @keyframes pulse {
      0%   { opacity: 1; transform: scale(1); }
      50%  { opacity: 0.4; transform: scale(0.85); }
      100% { opacity: 1; transform: scale(1); }
    }

    .manual-badge {
      font-size: 9px;
      font-family: 'IBM Plex Mono', monospace;
      letter-spacing: 0.08em;
      background: #1f2433;
      border: 1px solid #2e3450;
      border-radius: 3px;
      padding: 2px 5px;
      color: var(--muted);
      flex-shrink: 0;
    }

    @keyframes shimmer {
      0%   { opacity: 0.3; }
      50%  { opacity: 0.7; }
      100% { opacity: 0.3; }
    }
    .loading .status-dot { animation: shimmer 1.2s infinite; }
    .loading .card-status { animation: shimmer 1.2s infinite; }
  </style>
</head>
<body>

<header>
  <div class="header-left">
    <h1>BH Operations</h1>
    <h2>System Status Dashboard</h2>
  </div>
  <div class="header-right">
    <div id="clock">--:--:--</div>
    <div id="date">Loading...</div>
  </div>
</header>

<!-- CLINICAL & EHR -->
<div class="section-label">Clinical &amp; EHR</div>
<div class="grid">
  <a class="card loading" href="https://status.gethealthie.com" target="_blank" data-type="statuspage" data-url="https://status.gethealthie.com/api/v2/summary.json">
    <div class="status-dot"></div>
    <div class="card-info">
      <div class="card-name">Healthie</div>
      <div class="card-category">EHR / Scheduling</div>
    </div>
    <div class="card-status">···</div>
    <div class="card-arrow">↗</div>
  </a>

  <a class="card loading" href="https://status.dosespot.com" target="_blank" data-type="ping" data-url="https://status.dosespot.com">
    <div class="status-dot"></div>
    <div class="card-info">
      <div class="card-name">DoseSpot</div>
      <div class="card-category">ePrescribing</div>
    </div>
    <div class="card-status">···</div>
    <div class="card-arrow">↗</div>
  </a>

  <a class="card loading" href="https://statusgator.com/services/change-healthcare" target="_blank" data-type="statuspage" data-url="https://status.changehealthcare.com/api/v2/summary.json">
    <div class="status-dot"></div>
    <div class="card-info">
      <div class="card-name">Change Healthcare</div>
      <div class="card-category">Claims / Clearinghouse</div>
    </div>
    <div class="card-status">···</div>
    <div class="card-arrow">↗</div>
  </a>

  <a class="card loading" href="https://statusgator.com/services/fullscript" target="_blank" data-type="ping" data-url="https://statusgator.com/services/fullscript">
    <div class="status-dot"></div>
    <div class="card-info">
      <div class="card-name">Fullscript</div>
      <div class="card-category">Supplements</div>
    </div>
    <div class="card-status">···</div>
    <div class="card-arrow">↗</div>
  </a>

  <a class="card loading" href="https://status.sprucehealth.com" target="_blank" data-type="statuspage" data-url="https://status.sprucehealth.com/api/v2/summary.json">
    <div class="status-dot"></div>
    <div class="card-info">
      <div class="card-name">Spruce Health</div>
      <div class="card-category">Patient Messaging</div>
    </div>
    <div class="card-status">···</div>
    <div class="card-arrow">↗</div>
  </a>

  <a class="card manual" href="https://admin.morf.health/" target="_blank">
    <div class="status-dot"></div>
    <div class="card-info">
      <div class="card-name">Morf Health</div>
      <div class="card-category">Clinical</div>
    </div>
    <div class="card-status">Manual</div>
    <span class="manual-badge">no feed</span>
    <div class="card-arrow">↗</div>
  </a>
</div>

<!-- COMMUNICATIONS & SUPPORT -->
<div class="section-label">Communications &amp; Support</div>
<div class="grid">
  <a class="card loading" href="https://status.slack.com" target="_blank" data-type="ping" data-url="https://status.slack.com">
    <div class="status-dot"></div>
    <div class="card-info">
      <div class="card-name">Slack</div>
      <div class="card-category">Team Messaging</div>
    </div>
    <div class="card-status">···</div>
    <div class="card-arrow">↗</div>
  </a>

  <a class="card loading" href="https://status.helpscout.com" target="_blank" data-type="statuspage" data-url="https://status.helpscout.com/api/v2/summary.json">
    <div class="status-dot"></div>
    <div class="card-info">
      <div class="card-name">Help Scout</div>
      <div class="card-category">Customer Support</div>
    </div>
    <div class="card-status">···</div>
    <div class="card-arrow">↗</div>
  </a>

  <a class="card loading" href="https://www.google.com/appsstatus/dashboard/" target="_blank" data-type="ping" data-url="https://www.google.com/appsstatus/dashboard/">
    <div class="status-dot"></div>
    <div class="card-info">
      <div class="card-name">Google Workspace</div>
      <div class="card-category">Email / Drive / Docs</div>
    </div>
    <div class="card-status">···</div>
    <div class="card-arrow">↗</div>
  </a>
</div>

<!-- MARKETING & GROWTH -->
<div class="section-label">Marketing &amp; Growth</div>
<div class="grid">
  <a class="card loading" href="https://status.activecampaign.com" target="_blank" data-type="statuspage" data-url="https://status.activecampaign.com/api/v2/summary.json">
    <div class="status-dot"></div>
    <div class="card-info">
      <div class="card-name">ActiveCampaign</div>
      <div class="card-category">CRM / Automation</div>
    </div>
    <div class="card-status">···</div>
    <div class="card-arrow">↗</div>
  </a>

  <a class="card loading" href="https://status.klaviyo.com" target="_blank" data-type="statuspage" data-url="https://status.klaviyo.com/api/v2/summary.json">
    <div class="status-dot"></div>
    <div class="card-info">
      <div class="card-name">Klaviyo</div>
      <div class="card-category">Email Marketing</div>
    </div>
    <div class="card-status">···</div>
    <div class="card-arrow">↗</div>
  </a>
</div>

<!-- TECH & WEB -->
<div class="section-label">Tech &amp; Web</div>
<div class="grid">
  <a class="card loading" href="https://status.webflow.com" target="_blank" data-type="statuspage" data-url="https://status.webflow.com/api/v2/summary.json">
    <div class="status-dot"></div>
    <div class="card-info">
      <div class="card-name">Webflow</div>
      <div class="card-category">Website</div>
    </div>
    <div class="card-status">···</div>
    <div class="card-arrow">↗</div>
  </a>

  <a class="card loading" href="https://status.feathery.io" target="_blank" data-type="instatus" data-url="https://status.feathery.io/summary.json">
    <div class="status-dot"></div>
    <div class="card-info">
      <div class="card-name">Feathery</div>
      <div class="card-category">Forms</div>
    </div>
    <div class="card-status">···</div>
    <div class="card-arrow">↗</div>
  </a>

  <a class="card loading" href="https://status.zapier.com" target="_blank" data-type="statuspage" data-url="https://status.zapier.com/api/v2/summary.json">
    <div class="status-dot"></div>
    <div class="card-info">
      <div class="card-name">Zapier</div>
      <div class="card-category">Automation</div>
    </div>
    <div class="card-status">···</div>
    <div class="card-arrow">↗</div>
  </a>
</div>

<div class="footer">
  <div><span class="pulse"></span> Auto-refreshes every 5 minutes — click any card to view full details</div>
  <div id="last-checked">Checking...</div>
</div>

<script>
  // ── Clock ──────────────────────────────────────────────
  function updateClock() {
    const now = new Date();
    document.getElementById('clock').textContent =
      now.toLocaleTimeString('en-US', { hour12: false });
    document.getElementById('date').textContent =
      now.toLocaleDateString('en-US', {
        weekday: 'short', year: 'numeric', month: 'short', day: 'numeric'
      }).toUpperCase();
  }
  setInterval(updateClock, 1000);
  updateClock();

  // ── Apply status to a card ─────────────────────────────
  function applyStatus(card, state, label) {
    card.classList.remove('loading', 'operational', 'degraded', 'outage', 'unknown');
    card.classList.add(state);
    card.querySelector('.card-status').textContent = label;
  }

  // ── CORS proxy: try multiple fallbacks ─────────────────
  const PROXIES = [
    url => `https://corsproxy.io/?${encodeURIComponent(url)}`,
    url => `https://api.allorigins.win/raw?url=${encodeURIComponent(url)}`,
  ];

  async function fetchWithProxy(url) {
    for (const proxy of PROXIES) {
      try {
        const res = await fetch(proxy(url), { signal: AbortSignal.timeout(7000) });
        if (res.ok) return await res.json();
      } catch (_) { /* try next proxy */ }
    }
    return null;
  }

  // ── Statuspage.io indicator → state ───────────────────
  function statuspageIndicator(indicator) {
    if (!indicator) return ['unknown', '—'];
    switch (indicator) {
      case 'none':        return ['operational', 'OK'];
      case 'minor':       return ['degraded',    'Degraded'];
      case 'major':       return ['outage',      'Outage'];
      case 'critical':    return ['outage',      'Outage'];
      case 'maintenance': return ['degraded',    'Maint.'];
      default:            return ['unknown',     '—'];
    }
  }

  // ── Instatus page.status → state ──────────────────────
  function instatusState(status) {
    if (!status) return ['unknown', '—'];
    switch (status) {
      case 'UP':                return ['operational', 'OK'];
      case 'HASISSUES':         return ['degraded',    'Issues'];
      case 'UNDERMAINTENANCE':  return ['degraded',    'Maint.'];
      default:                  return ['unknown',     '—'];
    }
  }

  // ── Google Workspace: JSON feed ────────────────────────
  async function fetchGoogleStatus(card) {
    // Google publishes a JSON dashboard — scrape via proxy
    const url = 'https://www.google.com/appsstatus/json/en';
    const data = await fetchWithProxy(url);
    if (!data) { applyStatus(card, 'unknown', '—'); return; }
    // If any service is not 'ok', flag as degraded
    try {
      const services = data.services || [];
      const anyIssue = services.some(s => s.status && s.status !== 'ok');
      applyStatus(card, anyIssue ? 'degraded' : 'operational', anyIssue ? 'Issues' : 'OK');
    } catch (_) {
      applyStatus(card, 'unknown', '—');
    }
  }

  // ── Ping check: just see if the site responds ─────────
  async function pingCheck(card) {
    const url = card.dataset.url;
    const data = await fetchWithProxy(url);
    // If we got any response back, the site is reachable
    if (data !== null) {
      applyStatus(card, 'operational', 'OK');
    } else {
      // Try a raw fetch as last resort
      try {
        const res = await fetch(`https://corsproxy.io/?${encodeURIComponent(url)}`, { signal: AbortSignal.timeout(7000) });
        applyStatus(card, res.ok ? 'operational' : 'outage', res.ok ? 'OK' : 'Down');
      } catch (_) {
        applyStatus(card, 'unknown', '—');
      }
    }
  }

  // ── Main fetch dispatcher ──────────────────────────────
  async function fetchCard(card) {
    const type = card.dataset.type;
    const url  = card.dataset.url;

    if (type === 'manual') return; // skip manual cards

    if (type === 'ping') {
      await pingCheck(card);
      return;
    }

    const data = await fetchWithProxy(url);
    if (!data) { applyStatus(card, 'unknown', '—'); return; }

    if (type === 'statuspage') {
      const indicator = data?.status?.indicator;
      const [state, label] = statuspageIndicator(indicator);
      applyStatus(card, state, label);
    } else if (type === 'instatus') {
      const status = data?.page?.status;
      const [state, label] = instatusState(status);
      applyStatus(card, state, label);
    }
  }

  // ── Refresh all cards ──────────────────────────────────
  async function refresh() {
    const cards = document.querySelectorAll('.card[data-type]');
    // Add loading shimmer
    cards.forEach(c => {
      if (c.dataset.type !== 'manual') c.classList.add('loading');
    });
    await Promise.all([...cards].map(fetchCard));
    document.getElementById('last-checked').textContent =
      'Last checked: ' + new Date().toLocaleTimeString('en-US', {
        hour: '2-digit', minute: '2-digit', second: '2-digit'
      });
  }

  refresh();
  setInterval(refresh, 5 * 60 * 1000);
</script>
</body>
</html>
